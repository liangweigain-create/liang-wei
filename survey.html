<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>问卷生成器 | 管理员后台</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义主题（蓝白基调） -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF', // 主蓝色（专业沉稳）
                        secondary: '#36CFC9', // 辅助蓝绿色
                        neutral: '#F5F7FA', // 浅灰底色
                        'neutral-dark': '#4E5969', // 深灰文本
                        'border-light': '#E5E6EB' // 浅色边框
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 2px 8px rgba(22, 93, 255, 0.08);
            }
            .btn-hover {
                @apply transition-all duration-300 hover:shadow-md;
            }
        }
    </style>
    
    <style>
        /* 基础样式重置 */
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        
        /* 平滑过渡动画 */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.2s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-neutral min-h-screen text-neutral-dark">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 页面标题区 -->
        <header class="mb-10 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.2rem)] font-bold text-gray-800 mb-2">问卷生成器</h1>
            <p class="text-neutral-dark/70 max-w-2xl mx-auto">自定义创建问卷，支持多种题型与灵活配置</p>
        </header>
        
        <!-- 问卷编辑区（主卡片） -->
        <div class="bg-white rounded-xl card-shadow p-6 md:p-8 mb-8 fade-in">
            <!-- 问卷标题设置 -->
            <div class="mb-10 pb-6 border-b border-border-light">
                <label for="survey-title" class="block text-sm font-medium text-gray-700 mb-2">问卷标题</label>
                <input 
                    type="text" 
                    id="survey-title" 
                    placeholder="请输入问卷标题（如：用户满意度调查）" 
                    class="w-full px-4 py-3 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all"
                >
            </div>
            
            <!-- 问题列表容器 -->
            <div id="questions-container" class="space-y-6 mb-8">
                <!-- 初始问题 -->
                <div class="question-group bg-neutral p-5 rounded-lg border border-border-light slide-up">
                    <div class="flex flex-col md:flex-row md:items-end gap-4">
                        <!-- 问题标签输入 -->
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">问题内容</label>
                            <input 
                                type="text" 
                                class="question-label w-full px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all"
                                placeholder="请输入问题（如：您的年龄范围是？）"
                            >
                        </div>
                        
                        <!-- 问题类型选择 -->
                        <div class="w-full md:w-48">
                            <label class="block text-sm font-medium text-gray-700 mb-2">题型</label>
                            <select class="question-type w-full px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all bg-white">
                                <option value="text">单行文本</option>
                                <option value="number">数字输入</option>
                                <option value="textarea">多行文本</option>
                                <option value="radio">单选框</option>
                                <option value="checkbox">复选框</option>
                            </select>
                        </div>
                        
                        <!-- 操作按钮组 -->
                        <div class="flex gap-2">
                            <button type="button" class="add-question-btn p-2.5 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-all" title="添加问题">
                                <i class="fa fa-plus"></i>
                            </button>
                            <button type="button" class="delete-question-btn p-2.5 bg-gray-100 text-neutral-dark rounded-lg hover:bg-gray-200 transition-all" title="删除问题">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 选项配置区域 (单选/复选专用) -->
                    <div class="options-container mt-4 hidden slide-up">
                        <label class="block text-sm font-medium text-gray-700 mb-3">选项设置</label>
                        <div class="option-groups space-y-3">
                            <div class="flex items-center gap-3">
                                <input type="text" class="option-value flex-1 px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all" placeholder="选项内容（如：18-25岁）">
                                <button type="button" class="delete-option-btn p-2 text-neutral-dark/60 hover:text-primary transition-all">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" class="add-option-btn mt-3 px-4 py-2 bg-primary/5 text-primary rounded-lg hover:bg-primary/10 transition-all flex items-center gap-1">
                            <i class="fa fa-plus text-sm"></i> 添加选项
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 添加问题按钮 -->
            <button id="add-question-btn" type="button" class="w-full px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 btn-hover flex items-center justify-center gap-2">
                <i class="fa fa-plus-circle"></i> 添加新问题
            </button>
        </div>
        
        <!-- 底部操作栏 -->
        <div class="flex flex-wrap gap-3 justify-end">
            <button id="reset-btn" class="px-5 py-2.5 bg-white border border-border-light text-neutral-dark rounded-lg hover:bg-gray-50 btn-hover">
                <i class="fa fa-refresh mr-1"></i> 重置
            </button>
            <button id="preview-btn" class="px-5 py-2.5 bg-white border border-primary text-primary rounded-lg hover:bg-primary/5 btn-hover">
                <i class="fa fa-eye mr-1"></i> 预览
            </button>
            <button id="save-btn" class="px-5 py-2.5 bg-primary text-white rounded-lg hover:bg-primary/90 btn-hover">
                <i class="fa fa-save mr-1"></i> 保存配置
            </button>
        </div>
        
        <!-- 预览模态框 -->
        <div id="preview-modal" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 md:p-8 m-4 fade-in">
                <div class="flex justify-between items-center mb-6 pb-4 border-b border-border-light">
                    <h2 class="text-xl font-bold text-gray-800">问卷预览</h2>
                    <button id="close-preview" class="text-neutral-dark/60 hover:text-primary transition-all p-1">
                        <i class="fa fa-times text-lg"></i>
                    </button>
                </div>
                <div id="preview-content" class="space-y-8">
                    <!-- 预览内容动态生成 -->
                </div>
                <div class="mt-8 pt-4 border-t border-border-light text-right">
                    <button id="close-preview-btn" class="px-5 py-2.5 bg-primary text-white rounded-lg hover:bg-primary/90 btn-hover">
                        关闭预览
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM元素引用
        const questionsContainer = document.getElementById('questions-container');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const previewBtn = document.getElementById('preview-btn');
        const previewModal = document.getElementById('preview-modal');
        const closePreview = document.getElementById('close-preview');
        const closePreviewBtn = document.getElementById('close-preview-btn');
        const saveBtn = document.getElementById('save-btn');
        const resetBtn = document.getElementById('reset-btn');
        const previewContent = document.getElementById('preview-content');
        const surveyTitleInput = document.getElementById('survey-title');
        
        // 初始化问题计数
        let questionCount = 1;
        
        // 创建新问题组
        function createQuestionGroup() {
            questionCount++;
            
            // 创建问题组容器
            const questionGroup = document.createElement('div');
            questionGroup.className = 'question-group bg-neutral p-5 rounded-lg border border-border-light slide-up';
            questionGroup.setAttribute('data-question-id', `q-${questionCount}`);
            
            // 设置问题组HTML内容
            questionGroup.innerHTML = `
                <div class="flex flex-col md:flex-row md:items-end gap-4">
                    <!-- 问题标签输入 -->
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-2">问题内容</label>
                        <input 
                            type="text" 
                            class="question-label w-full px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all"
                            placeholder="请输入问题（如：您的年龄范围是？）"
                        >
                    </div>
                    
                    <!-- 问题类型选择 -->
                    <div class="w-full md:w-48">
                        <label class="block text-sm font-medium text-gray-700 mb-2">题型</label>
                        <select class="question-type w-full px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all bg-white">
                            <option value="text">单行文本</option>
                            <option value="number">数字输入</option>
                            <option value="textarea">多行文本</option>
                            <option value="radio">单选框</option>
                            <option value="checkbox">复选框</option>
                        </select>
                    </div>
                    
                    <!-- 操作按钮组 -->
                    <div class="flex gap-2">
                        <button type="button" class="add-question-btn p-2.5 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-all" title="添加问题">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button type="button" class="delete-question-btn p-2.5 bg-gray-100 text-neutral-dark rounded-lg hover:bg-gray-200 transition-all" title="删除问题">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 选项配置区域 (单选/复选专用) -->
                <div class="options-container mt-4 hidden slide-up">
                    <label class="block text-sm font-medium text-gray-700 mb-3">选项设置</label>
                    <div class="option-groups space-y-3">
                        <div class="flex items-center gap-3">
                            <input type="text" class="option-value flex-1 px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all" placeholder="选项内容（如：18-25岁）">
                            <button type="button" class="delete-option-btn p-2 text-neutral-dark/60 hover:text-primary transition-all">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="add-option-btn mt-3 px-4 py-2 bg-primary/5 text-primary rounded-lg hover:bg-primary/10 transition-all flex items-center gap-1">
                        <i class="fa fa-plus text-sm"></i> 添加选项
                    </button>
                </div>
            `;
            
            // 添加事件监听器
            setupQuestionGroupEvents(questionGroup);
            
            return questionGroup;
        }
        
        // 为问题组设置事件监听
        function setupQuestionGroupEvents(questionGroup) {
            // 添加问题按钮
            const addBtn = questionGroup.querySelector('.add-question-btn');
            addBtn.addEventListener('click', () => {
                const newQuestion = createQuestionGroup();
                questionGroup.after(newQuestion);
                newQuestion.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
            
            // 删除问题按钮
            const deleteBtn = questionGroup.querySelector('.delete-question-btn');
            deleteBtn.addEventListener('click', () => {
                if (questionsContainer.querySelectorAll('.question-group').length > 1) {
                    // 添加入场动画
                    questionGroup.classList.add('opacity-0', 'transform', 'translate-x-2');
                    questionGroup.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
                    
                    setTimeout(() => {
                        questionGroup.remove();
                    }, 200);
                } else {
                    alert('至少需要保留一个问题');
                }
            });
            
            // 问题类型变更事件
            const typeSelect = questionGroup.querySelector('.question-type');
            const optionsContainer = questionGroup.querySelector('.options-container');
            
            function toggleOptionsContainer() {
                const isSelectType = ['radio', 'checkbox'].includes(typeSelect.value);
                if (isSelectType) {
                    optionsContainer.classList.remove('hidden');
                    // 触发动画
                    setTimeout(() => optionsContainer.classList.add('slide-up'), 10);
                } else {
                    optionsContainer.classList.add('hidden');
                }
            }
            
            // 初始检查与类型变更监听
            toggleOptionsContainer();
            typeSelect.addEventListener('change', toggleOptionsContainer);
            
            // 添加选项按钮
            const addOptionBtn = questionGroup.querySelector('.add-option-btn');
            addOptionBtn.addEventListener('click', () => {
                const optionGroups = questionGroup.querySelector('.option-groups');
                const newOption = createOption();
                optionGroups.appendChild(newOption);
                newOption.querySelector('.option-value').focus();
            });
            
            // 为现有选项添加删除事件
            setupOptionEvents(questionGroup);
        }
        
        // 创建新选项
        function createOption() {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'flex items-center gap-3 slide-up';
            optionDiv.innerHTML = `
                <input type="text" class="option-value flex-1 px-4 py-2.5 border border-border-light rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all" placeholder="选项内容（如：18-25岁）">
                <button type="button" class="delete-option-btn p-2 text-neutral-dark/60 hover:text-primary transition-all">
                    <i class="fa fa-times"></i>
                </button>
            `;
            
            // 添加删除选项事件
            const deleteBtn = optionDiv.querySelector('.delete-option-btn');
            deleteBtn.addEventListener('click', () => {
                if (optionDiv.parentElement.children.length > 1) {
                    optionDiv.remove();
                } else {
                    alert('至少需要保留一个选项');
                }
            });
            
            return optionDiv;
        }
        
        // 为选项设置事件监听
        function setupOptionEvents(questionGroup) {
            const deleteOptionBtns = questionGroup.querySelectorAll('.delete-option-btn');
            deleteOptionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const optionDiv = btn.closest('.flex');
                    const optionGroups = questionGroup.querySelector('.option-groups');
                    
                    if (optionGroups.children.length > 1) {
                        optionDiv.remove();
                    } else {
                        alert('至少需要保留一个选项');
                    }
                });
            });
        }
        
        // 生成预览
        function generatePreview() {
            previewContent.innerHTML = '';
            
            // 添加问卷标题
            const title = surveyTitleInput.value || '未命名问卷';
            const titleElement = document.createElement('h2');
            titleElement.className = 'text-2xl font-bold text-gray-800 mb-6 pb-2 border-b border-border-light';
            titleElement.textContent = title;
            previewContent.appendChild(titleElement);
            
            // 获取所有问题
            const questionGroups = questionsContainer.querySelectorAll('.question-group');
            
            questionGroups.forEach((group, index) => {
                const questionLabel = group.querySelector('.question-label').value || `问题 ${index + 1}`;
                const questionType = group.querySelector('.question-type').value;
                
                // 创建问题容器
                const questionDiv = document.createElement('div');
                questionDiv.className = 'mb-6';
                
                // 添加问题标题
                const questionTitle = document.createElement('label');
                questionTitle.className = 'block text-gray-700 font-medium mb-3';
                questionTitle.textContent = `${index + 1}. ${questionLabel}`;
                questionDiv.appendChild(questionTitle);
                
                // 根据类型添加不同的输入控件
                switch (questionType) {
                    case 'text':
                        const textInput = document.createElement('input');
                        textInput.type = 'text';
                        textInput.className = 'w-full px-4 py-2.5 border border-border-light rounded-lg';
                        textInput.placeholder = '请输入答案';
                        questionDiv.appendChild(textInput);
                        break;
                        
                    case 'number':
                        const numberInput = document.createElement('input');
                        numberInput.type = 'number';
                        numberInput.className = 'w-full px-4 py-2.5 border border-border-light rounded-lg';
                        numberInput.placeholder = '请输入数字';
                        questionDiv.appendChild(numberInput);
                        break;
                        
                    case 'textarea':
                        const textarea = document.createElement('textarea');
                        textarea.className = 'w-full px-4 py-2.5 border border-border-light rounded-lg';
                        textarea.rows = 4;
                        textarea.placeholder = '请输入详细内容';
                        questionDiv.appendChild(textarea);
                        break;
                        
                    case 'radio':
                        const radioGroup = document.createElement('div');
                        radioGroup.className = 'space-y-2';
                        
                        const radioOptions = group.querySelectorAll('.option-value');
                        radioOptions.forEach((option, optIndex) => {
                            const optionValue = option.value || `选项 ${optIndex + 1}`;
                            const radioDiv = document.createElement('div');
                            radioDiv.className = 'flex items-center';
                            
                            radioDiv.innerHTML = `
                                <input type="radio" name="preview-radio-${index}" id="preview-radio-${index}-${optIndex}" class="mr-2">
                                <label for="preview-radio-${index}-${optIndex}">${optionValue}</label>
                            `;
                            
                            radioGroup.appendChild(radioDiv);
                        });
                        
                        questionDiv.appendChild(radioGroup);
                        break;
                        
                    case 'checkbox':
                        const checkboxGroup = document.createElement('div');
                        checkboxGroup.className = 'space-y-2';
                        
                        const checkboxOptions = group.querySelectorAll('.option-value');
                        checkboxOptions.forEach((option, optIndex) => {
                            const optionValue = option.value || `选项 ${optIndex + 1}`;
                            const checkboxDiv = document.createElement('div');
                            checkboxDiv.className = 'flex items-center';
                            
                            checkboxDiv.innerHTML = `
                                <input type="checkbox" id="preview-checkbox-${index}-${optIndex}" class="mr-2">
                                <label for="preview-checkbox-${index}-${optIndex}">${optionValue}</label>
                            `;
                            
                            checkboxGroup.appendChild(checkboxDiv);
                        });
                        
                        questionDiv.appendChild(checkboxGroup);
                        break;
                }
                
                previewContent.appendChild(questionDiv);
            });
            
            // 添加提交按钮
            const submitDiv = document.createElement('div');
            submitDiv.className = 'mt-8 text-center';
            submitDiv.innerHTML = `
                <button class="px-6 py-2.5 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    提交问卷
                </button>
            `;
            previewContent.appendChild(submitDiv);
        }
        
        // 保存配置
        function saveConfiguration() {
            const surveyConfig = {
                title: surveyTitleInput.value || '未命名问卷',
                questions: []
            };
            
            // 收集所有问题配置
            const questionGroups = questionsContainer.querySelectorAll('.question-group');
            questionGroups.forEach((group, index) => {
                const questionLabel = group.querySelector('.question-label').value || `问题 ${index + 1}`;
                const questionType = group.querySelector('.question-type').value;
                
                const questionConfig = {
                    id: `q-${index + 1}`,
                    label: questionLabel,
                    type: questionType
                };
                
                // 如果是单选或复选，收集选项
                if (['radio', 'checkbox'].includes(questionType)) {
                    const options = [];
                    group.querySelectorAll('.option-value').forEach((option, optIndex) => {
                        const optionValue = option.value || `选项 ${optIndex + 1}`;
                        options.push({
                            id: `opt-${index + 1}-${optIndex + 1}`,
                            value: optionValue
                        });
                    });
                    questionConfig.options = options;
                }
                
                surveyConfig.questions.push(questionConfig);
            });
            
            // 在实际应用中，这里会将配置发送到服务器
            console.log('保存的问卷配置:', surveyConfig);
            
            // 显示保存成功提示
            alert('问卷配置已保存！');
        }
        
        // 重置表单
        function resetForm() {
            if (confirm('确定要重置所有设置吗？这将清除所有已输入的内容。')) {
                // 清空标题
                surveyTitleInput.value = '';
                
                // 保留第一个问题组，清空其内容
                const questionGroups = questionsContainer.querySelectorAll('.question-group');
                questionGroups.forEach((group, index) => {
                    if (index === 0) {
                        // 清空第一个问题的内容
                        group.querySelector('.question-label').value = '';
                        group.querySelector('.question-type').value = 'text';
                        group.querySelector('.options-container').classList.add('hidden');
                        
                        // 清空选项
                        const optionGroups = group.querySelector('.option-groups');
                        const firstOption = optionGroups.querySelector('.flex');
                        optionGroups.innerHTML = '';
                        optionGroups.appendChild(firstOption);
                        firstOption.querySelector('.option-value').value = '';
                    } else {
                        // 删除其他问题组
                        group.remove();
                    }
                });
                
                questionCount = 1;
            }
        }
        
        // 初始化事件监听
        function initEvents() {
            // 添加问题按钮
            addQuestionBtn.addEventListener('click', () => {
                const newQuestion = createQuestionGroup();
                questionsContainer.appendChild(newQuestion);
                newQuestion.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
            
            // 为初始问题组设置事件
            const initialQuestion = questionsContainer.querySelector('.question-group');
            setupQuestionGroupEvents(initialQuestion);
            
            // 预览相关事件
            previewBtn.addEventListener('click', () => {
                generatePreview();
                previewModal.classList.remove('hidden');
            });
            
            function closePreviewModal() {
                previewModal.classList.add('hidden');
            }
            
            closePreview.addEventListener('click', closePreviewModal);
            closePreviewBtn.addEventListener('click', closePreviewModal);
            
            // 点击模态框外部关闭
            previewModal.addEventListener('click', (e) => {
                if (e.target === previewModal) {
                    closePreviewModal();
                }
            });
            
            // 保存配置
            saveBtn.addEventListener('click', saveConfiguration);
            
            // 重置表单
            resetBtn.addEventListener('click', resetForm);
        }
        
        // 初始化应用
        initEvents();
    </script>
</body>
</html>